---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getDictionary, isLocale } from '../../../i18n';
import type { Locale } from '../../../i18n/config';
import { getCollection } from 'astro:content';

const { lang } = Astro.params;

if (!isLocale(lang)) {
  return Astro.redirect('/zh/blog/');
}

const locale = lang as Locale;
const dict = await getDictionary(locale);
const dateLocale = locale === 'zh' ? 'zh-CN' : 'en-US';
const posts = (
  await getCollection('blog', (entry) => entry.id.startsWith(`${locale}/`))
)
  .sort((a, b) => b.data.published.getTime() - a.data.published.getTime());
---
<BaseLayout lang={locale} dict={dict} title={dict.nav.blog}>
  <section class="blog">
    <h1>{dict.sections.latestArticles}</h1>
    <div class="blog-grid">
      {posts.map((post) => (
        <article class="blog-card">
          <h2>{post.data.title}</h2>
          <p>{post.data.description}</p>
          <p class="blog-card__meta">{dict.blog.publishedOn} {post.data.published.toLocaleDateString(dateLocale)}</p>
          <a class="blog-card__cta" href={`/${locale}/blog/${post.slug}/`}>{dict.blog.readMore}</a>
        </article>
      ))}
    </div>
  </section>
</BaseLayout>
<style>
  .blog {
    display: grid;
    gap: 1.5rem;
  }

  .blog-grid {
    display: grid;
    gap: 1.5rem;
  }

  @media (min-width: 720px) {
    .blog-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }

  .blog-card {
    background: white;
    border-radius: 1rem;
    padding: 1.5rem;
    box-shadow: 0 1rem 2rem rgba(15, 23, 42, 0.08);
  }

  .blog-card__meta {
    color: color-mix(in srgb, currentColor 65%, transparent);
    font-size: 0.875rem;
  }

  .blog-card__cta {
    display: inline-block;
    margin-top: 1rem;
    font-weight: 600;
  }
</style>
