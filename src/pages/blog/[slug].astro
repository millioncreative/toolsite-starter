---
import BaseLayout from '@layouts/BaseLayout.astro';
import { getCollection, getEntryBySlug } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({ params: { slug: post.slug } }));
}

const { slug } = Astro.params;
const entry = await getEntryBySlug('blog', slug);

if (!entry) {
  throw new Error(`未找到对应的文章：${slug}`);
}

const { Content } = await entry.render();
const canonical = Astro.site ? new URL(`/blog/${entry.slug}/`, Astro.site).href : undefined;
---
<BaseLayout title={entry.data.title} description={entry.data.description} canonical={canonical}>
  <article class="max-w-3xl leading-relaxed text-slate-100">
    <header class="mb-8 flex flex-col gap-3">
      <p class="text-xs uppercase tracking-[0.3em] text-accent">Toolsite Blog</p>
      <h1 class="text-4xl font-semibold text-white">{entry.data.title}</h1>
      <time class="text-xs text-slate-400">
        {new Intl.DateTimeFormat('zh-CN', { dateStyle: 'long' }).format(entry.data.publishDate)}
      </time>
      <p class="text-base text-slate-200">{entry.data.description}</p>
    </header>
    <div class="mt-8 space-y-6 text-base text-slate-200 [&_strong]:text-white [&_h2]:text-2xl [&_h2]:font-semibold [&_h2]:text-white [&_h2]:mt-8 [&_h3]:text-xl [&_h3]:mt-6">
      <Content />
    </div>
  </article>
</BaseLayout>
